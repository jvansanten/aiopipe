<!doctype html>
<html>
<head>
    <!-- Documentation generated by pdoc3k -->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>aiopipe API documentation</title>
    <meta name="description" content="This package wraps the [`os.pipe`](https://docs.python.org/3/library/os.html#os.pipe)" />

    <style>
    /*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */

/* Document
   ========================================================================== */

/**
 * 1. Correct the line height in all browsers.
 * 2. Prevent adjustments of font size after orientation changes in
 *    IE on Windows Phone and in iOS.
 */

html {
  line-height: 1.15; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}

/* Sections
   ========================================================================== */

/**
 * Remove the margin in all browsers (opinionated).
 */

body {
  margin: 0;
}

/**
 * Add the correct display in IE 9-.
 */

article,
aside,
footer,
header,
nav,
section {
  display: block;
}

/**
 * Correct the font size and margin on `h1` elements within `section` and
 * `article` contexts in Chrome, Firefox, and Safari.
 */

h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

/* Grouping content
   ========================================================================== */

/**
 * Add the correct display in IE 9-.
 * 1. Add the correct display in IE.
 */

figcaption,
figure,
main { /* 1 */
  display: block;
}

/**
 * Add the correct margin in IE 8.
 */

figure {
  margin: 1em 40px;
}

/**
 * 1. Add the correct box sizing in Firefox.
 * 2. Show the overflow in Edge and IE.
 */

hr {
  box-sizing: content-box; /* 1 */
  height: 0; /* 1 */
  overflow: visible; /* 2 */
}

/**
 * 1. Correct the inheritance and scaling of font size in all browsers.
 * 2. Correct the odd `em` font sizing in all browsers.
 */

pre {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}

/* Text-level semantics
   ========================================================================== */

/**
 * 1. Remove the gray background on active links in IE 10.
 * 2. Remove gaps in links underline in iOS 8+ and Safari 8+.
 */

a {
  background-color: transparent; /* 1 */
  -webkit-text-decoration-skip: objects; /* 2 */
}

/**
 * 1. Remove the bottom border in Chrome 57- and Firefox 39-.
 * 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari.
 */

abbr[title] {
  border-bottom: none; /* 1 */
  text-decoration: underline; /* 2 */
  text-decoration: underline dotted; /* 2 */
}

/**
 * Prevent the duplicate application of `bolder` by the next rule in Safari 6.
 */

b,
strong {
  font-weight: inherit;
}

/**
 * Add the correct font weight in Chrome, Edge, and Safari.
 */

b,
strong {
  font-weight: bolder;
}

/**
 * 1. Correct the inheritance and scaling of font size in all browsers.
 * 2. Correct the odd `em` font sizing in all browsers.
 */

code,
kbd,
samp {
  font-family: monospace, monospace; /* 1 */
  font-size: 1em; /* 2 */
}

/**
 * Add the correct font style in Android 4.3-.
 */

dfn {
  font-style: italic;
}

/**
 * Add the correct background and color in IE 9-.
 */

mark {
  background-color: #ff0;
  color: #000;
}

/**
 * Add the correct font size in all browsers.
 */

small {
  font-size: 80%;
}

/**
 * Prevent `sub` and `sup` elements from affecting the line height in
 * all browsers.
 */

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sub {
  bottom: -0.25em;
}

sup {
  top: -0.5em;
}

/* Embedded content
   ========================================================================== */

/**
 * Add the correct display in IE 9-.
 */

audio,
video {
  display: inline-block;
}

/**
 * Add the correct display in iOS 4-7.
 */

audio:not([controls]) {
  display: none;
  height: 0;
}

/**
 * Remove the border on images inside links in IE 10-.
 */

img {
  border-style: none;
}

/**
 * Hide the overflow in IE.
 */

svg:not(:root) {
  overflow: hidden;
}

/* Forms
   ========================================================================== */

/**
 * 1. Change the font styles in all browsers (opinionated).
 * 2. Remove the margin in Firefox and Safari.
 */

button,
input,
optgroup,
select,
textarea {
  font-family: sans-serif; /* 1 */
  font-size: 100%; /* 1 */
  line-height: 1.15; /* 1 */
  margin: 0; /* 2 */
}

/**
 * Show the overflow in IE.
 * 1. Show the overflow in Edge.
 */

button,
input { /* 1 */
  overflow: visible;
}

/**
 * Remove the inheritance of text transform in Edge, Firefox, and IE.
 * 1. Remove the inheritance of text transform in Firefox.
 */

button,
select { /* 1 */
  text-transform: none;
}

/**
 * 1. Prevent a WebKit bug where (2) destroys native `audio` and `video`
 *    controls in Android 4.
 * 2. Correct the inability to style clickable types in iOS and Safari.
 */

button,
html [type="button"], /* 1 */
[type="reset"],
[type="submit"] {
  -webkit-appearance: button; /* 2 */
}

/**
 * Remove the inner border and padding in Firefox.
 */

button::-moz-focus-inner,
[type="button"]::-moz-focus-inner,
[type="reset"]::-moz-focus-inner,
[type="submit"]::-moz-focus-inner {
  border-style: none;
  padding: 0;
}

/**
 * Restore the focus styles unset by the previous rule.
 */

button:-moz-focusring,
[type="button"]:-moz-focusring,
[type="reset"]:-moz-focusring,
[type="submit"]:-moz-focusring {
  outline: 1px dotted ButtonText;
}

/**
 * Correct the padding in Firefox.
 */

fieldset {
  padding: 0.35em 0.75em 0.625em;
}

/**
 * 1. Correct the text wrapping in Edge and IE.
 * 2. Correct the color inheritance from `fieldset` elements in IE.
 * 3. Remove the padding so developers are not caught out when they zero out
 *    `fieldset` elements in all browsers.
 */

legend {
  box-sizing: border-box; /* 1 */
  color: inherit; /* 2 */
  display: table; /* 1 */
  max-width: 100%; /* 1 */
  padding: 0; /* 3 */
  white-space: normal; /* 1 */
}

/**
 * 1. Add the correct display in IE 9-.
 * 2. Add the correct vertical alignment in Chrome, Firefox, and Opera.
 */

progress {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}

/**
 * Remove the default vertical scrollbar in IE.
 */

textarea {
  overflow: auto;
}

/**
 * 1. Add the correct box sizing in IE 10-.
 * 2. Remove the padding in IE 10-.
 */

[type="checkbox"],
[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}

/**
 * Correct the cursor style of increment and decrement buttons in Chrome.
 */

[type="number"]::-webkit-inner-spin-button,
[type="number"]::-webkit-outer-spin-button {
  height: auto;
}

/**
 * 1. Correct the odd appearance in Chrome and Safari.
 * 2. Correct the outline style in Safari.
 */

[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  outline-offset: -2px; /* 2 */
}

/**
 * Remove the inner padding and cancel buttons in Chrome and Safari on macOS.
 */

[type="search"]::-webkit-search-cancel-button,
[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

/**
 * 1. Correct the inability to style clickable types in iOS and Safari.
 * 2. Change font properties to `inherit` in Safari.
 */

::-webkit-file-upload-button {
  -webkit-appearance: button; /* 1 */
  font: inherit; /* 2 */
}

/* Interactive
   ========================================================================== */

/*
 * Add the correct display in IE 9-.
 * 1. Add the correct display in Edge, IE, and Firefox.
 */

details, /* 1 */
menu {
  display: block;
}

/*
 * Add the correct display in all browsers.
 */

summary {
  display: list-item;
}

/* Scripting
   ========================================================================== */

/**
 * Add the correct display in IE 9-.
 */

canvas {
  display: inline-block;
}

/**
 * Add the correct display in IE.
 */

template {
  display: none;
}

/* Hidden
   ========================================================================== */

/**
 * Add the correct display in IE 10-.
 */

[hidden] {
  display: none;
}
    </style>

    
    <style>
      .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #ffffff; }
.codehilite .c { color: #999988; font-style: italic } /* Comment */
.codehilite .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.codehilite .k { font-weight: bold } /* Keyword */
.codehilite .o { font-weight: bold } /* Operator */
.codehilite .ch { color: #999988; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.codehilite .cpf { color: #999988; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #999988; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #aa0000 } /* Generic.Error */
.codehilite .gh { color: #999999 } /* Generic.Heading */
.codehilite .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #555555 } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #aaaaaa } /* Generic.Subheading */
.codehilite .gt { color: #aa0000 } /* Generic.Traceback */
.codehilite .kc { font-weight: bold } /* Keyword.Constant */
.codehilite .kd { font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { font-weight: bold } /* Keyword.Pseudo */
.codehilite .kr { font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.codehilite .m { color: #009999 } /* Literal.Number */
.codehilite .s { color: #bb8844 } /* Literal.String */
.codehilite .na { color: #008080 } /* Name.Attribute */
.codehilite .nb { color: #999999 } /* Name.Builtin */
.codehilite .nc { color: #445588; font-weight: bold } /* Name.Class */
.codehilite .no { color: #008080 } /* Name.Constant */
.codehilite .ni { color: #800080 } /* Name.Entity */
.codehilite .ne { color: #990000; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #990000; font-weight: bold } /* Name.Function */
.codehilite .nn { color: #555555 } /* Name.Namespace */
.codehilite .nt { color: #000080 } /* Name.Tag */
.codehilite .nv { color: #008080 } /* Name.Variable */
.codehilite .ow { font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #009999 } /* Literal.Number.Bin */
.codehilite .mf { color: #009999 } /* Literal.Number.Float */
.codehilite .mh { color: #009999 } /* Literal.Number.Hex */
.codehilite .mi { color: #009999 } /* Literal.Number.Integer */
.codehilite .mo { color: #009999 } /* Literal.Number.Oct */
.codehilite .sa { color: #bb8844 } /* Literal.String.Affix */
.codehilite .sb { color: #bb8844 } /* Literal.String.Backtick */
.codehilite .sc { color: #bb8844 } /* Literal.String.Char */
.codehilite .dl { color: #bb8844 } /* Literal.String.Delimiter */
.codehilite .sd { color: #bb8844 } /* Literal.String.Doc */
.codehilite .s2 { color: #bb8844 } /* Literal.String.Double */
.codehilite .se { color: #bb8844 } /* Literal.String.Escape */
.codehilite .sh { color: #bb8844 } /* Literal.String.Heredoc */
.codehilite .si { color: #bb8844 } /* Literal.String.Interpol */
.codehilite .sx { color: #bb8844 } /* Literal.String.Other */
.codehilite .sr { color: #808000 } /* Literal.String.Regex */
.codehilite .s1 { color: #bb8844 } /* Literal.String.Single */
.codehilite .ss { color: #bb8844 } /* Literal.String.Symbol */
.codehilite .bp { color: #999999 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #990000; font-weight: bold } /* Name.Function.Magic */
.codehilite .vc { color: #008080 } /* Name.Variable.Class */
.codehilite .vg { color: #008080 } /* Name.Variable.Global */
.codehilite .vi { color: #008080 } /* Name.Variable.Instance */
.codehilite .vm { color: #008080 } /* Name.Variable.Magic */
.codehilite .il { color: #009999 } /* Literal.Number.Integer.Long */
    </style>
    

    <style>
    * {
    box-sizing: border-box;
}

html, body, main {
    margin: 0;
    padding: 0;
    min-height: 100vh;
}

body {
    background: #fff;
    font-size: 16px;
    font-family: sans-serif;
    line-height: 1.6rem;
}

.indextitle, .modtitle {
    font-size: 1.25rem;
    margin: 0 0 .70rem 0;
    font-weight: bold;
}

.sectiontitle {
    font-size: 1.25rem;
    margin: 2rem 0 1rem 0;
    font-weight: bold;
    border-bottom: 1px solid #000;
}

.itemtitle {
    font-size: inherit;
    margin: 0 0 10px 0;
    font-weight: bold;
}

a {
    text-decoration: none;
}

code, pre {
    background: #f8f8f8;
}

code {
    padding: 0 4px;
}

pre {
    padding: 16px 20px;
    overflow-x: auto;
}

main {
    display: flex;
}

#index-column {
    flex: none;
    padding: 30px;
    overflow: hidden;
    min-width: 20%;
    max-width: 25%;
}

#index {
    list-style: none;
    margin: 0;
    padding: 0;
}

.indexsection:not(:last-child) {
    margin-bottom: 16px;
}

.indexsection ul {
    list-style: none;
    margin: 0;
    padding-left: 0;
}

.objlist {
    font-family: monospace;
}

.objlist ul {
    padding-left: 2rem;
}

.breadcrumblink, .sectionlink {
    color: #000;
}

#module-column {
    flex: 1;
    padding: 30px 60px;
    border: 0 solid #ddd;
    border-width: 0 0 0 1px;
}

#module-contents {
    max-width: 1000px;
}

.name {
    color: #000;
    font-family: monospace;
    font-weight: bold;
}

.ident {
    color: #900;
}

.assign {
    font-weight: normal;
    font-family: monospace;
}

.annotation {
    font-family: monospace;
}

.item {
    margin: 0 0 15px 0;
}

.class {
    margin: 0 0 25px 30px;
}

.ancestors {
    margin: 0 0 10px 0;
}

.inheritance {
    margin: 0 0 5px 30px;
}

.inherited {
    color: #666;
}

.desc h1, .desc h2, .desc h3, .desc h4, .desc h5, .desc h6 {
    font-size: inherit;
    font-weight: bold;
    margin: 0.5rem 0;
}

.desc p {
    margin: 10px 0;
}

.funcdef {
    display: flex;
    flex-wrap: wrap;
    padding-left: 4em;
    font-family: monospace;
    font-weight: bold;
}

.funcinit {
    display: flex;
    margin-left: -4em;
}

.funcname, .funcargs {
    text-align: left;
}

.funcname, .funcret {
    white-space: nowrap;
}

.funcret {
    font-family: monospace;
    font-weight: bold;
}

.funcarrow {
    margin: 0 0.5em;
}

.sourcecontainer {
    margin-bottom: 10px;
}

.sourcebutton {
    font-size: .85rem;
    text-transform: uppercase;
    color: #444;
}

.expandicon {
    display: inline-block;
    position: relative;
    border-radius: 25%;
    width: 10px;
    height: 10px;
    background-color: #888;
}

.expandicon::after {
    content: "";
    position: absolute;
    display: block;
    background-color: #fff;
    height: 2px;
    margin-top: -1px;
    top: 50%;
    left: 2px;
    right: 2px;
}

.expandicon::before {
    content: "";
    position: absolute;
    display: block;
    background-color: #fff;
    width: 2px;
    margin-left: -1px;
    top: 2px;
    left: 50%;
    bottom: 2px;
}

.expandicon.active::before {
    display: none;
}

.source {
    margin-bottom: 15px;
}

.source pre {
    max-height: 600px;
    overflow-y: auto;
}

.codehilite {
    background: inherit;
}

.hidden {
    display: none;
}

/* Widescreen */
@media all and (min-width: 1400px) {
    #index-column {
        min-width: 10%;
        max-width: 25%;
    }
}

/* Touch screen */
@media all and (max-width: 900px) {
    #index-column {
        max-width: 20%;
    }
}

/* Mobile screen */
@media all and (max-width: 750px) {
    main {
        flex-direction: column;
    }

    #index-column {
        max-width: none;
    }

    #module-column {
        padding: 30px;
        border-width: 1px 0 0 0;
    }
}
    </style>

    <style>
    @media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    html, body, main {
        min-height: auto;
    }

    main {
        display: block;
    }

    #index-column {
        display: none;
    }

    #content-column {
        border: 0;
        padding: 0;
    }

    .sourcebutton {
        display: none;
    }

    a, a:visited {
        text-decoration: underline;
    }

    pre, blockquote {
        border: 1px solid #999;
    }

    thead {
        display: table-header-group;
    }

    tr, img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }
}
    </style>
</head>
<body>
    <main>
        
    
    
    
    
    

    
        <div id="index-column">
            <ul id="index">
            

            
                <li class="indexsection">
                    <h1 class="indextitle">
                        <a href="#header-functions" class="sectionlink">Functions</a>
                    </h1>
                    <ul class="objlist">
    
        <li><a href="#aiopipe.aioduplex" title="aiopipe.aioduplex">aioduplex</a></lI>
    
        <li><a href="#aiopipe.aiopipe" title="aiopipe.aiopipe">aiopipe</a></lI>
    
    </ul>
                </li>
            

            
        <li class="indexsection">
            <h1 class="indextitle">
                <a href="#header-classes" class="sectionlink">Classes</a>
            </h1>
            <ul class="objlist">
            
                <li>
                    <a href="#aiopipe.AioDuplex" title="aiopipe.AioDuplex">AioDuplex</a>
                    
                    
                        <ul class="objlist">
    
        <li><a href="#aiopipe.AioDuplex.detach" title="aiopipe.AioDuplex.detach">detach</a></lI>
    
        <li><a href="#aiopipe.AioDuplex.open" title="aiopipe.AioDuplex.open">open</a></lI>
    
    </ul>
                    
                </li>
            
                <li>
                    <a href="#aiopipe.AioDuplexConnection" title="aiopipe.AioDuplexConnection">AioDuplexConnection</a>
                    
                    
                        <ul class="objlist">
    
        <li><a href="#aiopipe.AioDuplexConnection.read" title="aiopipe.AioDuplexConnection.read">read</a></lI>
    
        <li><a href="#aiopipe.AioDuplexConnection.reader" title="aiopipe.AioDuplexConnection.reader">reader</a></lI>
    
        <li><a href="#aiopipe.AioDuplexConnection.write" title="aiopipe.AioDuplexConnection.write">write</a></lI>
    
        <li><a href="#aiopipe.AioDuplexConnection.writer" title="aiopipe.AioDuplexConnection.writer">writer</a></lI>
    
    </ul>
                    
                </li>
            
                <li>
                    <a href="#aiopipe.AioPipeReader" title="aiopipe.AioPipeReader">AioPipeReader</a>
                    
                    
                        <ul class="objlist">
    
        <li><a href="#aiopipe.AioPipeReader.detach" title="aiopipe.AioPipeReader.detach">detach</a></lI>
    
        <li><a href="#aiopipe.AioPipeReader.open" title="aiopipe.AioPipeReader.open">open</a></lI>
    
    </ul>
                    
                </li>
            
                <li>
                    <a href="#aiopipe.AioPipeStream" title="aiopipe.AioPipeStream">AioPipeStream</a>
                    
                    
                        <ul class="objlist">
    
        <li><a href="#aiopipe.AioPipeStream.detach" title="aiopipe.AioPipeStream.detach">detach</a></lI>
    
    </ul>
                    
                </li>
            
                <li>
                    <a href="#aiopipe.AioPipeWriter" title="aiopipe.AioPipeWriter">AioPipeWriter</a>
                    
                    
                        <ul class="objlist">
    
        <li><a href="#aiopipe.AioPipeWriter.detach" title="aiopipe.AioPipeWriter.detach">detach</a></lI>
    
        <li><a href="#aiopipe.AioPipeWriter.open" title="aiopipe.AioPipeWriter.open">open</a></lI>
    
    </ul>
                    
                </li>
            
            </ul>
        </li>
    
            
            

            
            </ul>
        </div>
    
        
    <div id="module-column">
        <div id="module-contents">
            
    
    
    
    
    

    <header id="section-intro">
        <h1 class="modtitle">
            Module <span class="name"><a class="breadcrumblink" href="">aiopipe</a></span>
        </h1>
        
    
        
        <div class="desc"><p>This package wraps the <a href="https://docs.python.org/3/library/os.html#os.pipe"><code>os.pipe</code></a>
simplex communication pipe so it can be used as part of the non-blocking
<a href="https://docs.python.org/3/library/asyncio.html"><code>asyncio</code></a> event loop. A duplex pipe
is also provided, which allows reading and writing on both ends.</p>
<h2 id="simplex-example">Simplex example</h2>
<p>The following example opens a pipe with the write end in the child process and the read
end in the parent process.</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Process</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">asyncio</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">aiopipe</span> <span class="k">import</span> <span class="n">aiopipe</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">rx</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">aiopipe</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="k">with</span> <span class="n">tx</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">proc</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">childproc</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">tx</span><span class="p">,))</span>
<span class="o">...</span>         <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="c1"># The write end is now available in the child process</span>
<span class="o">...</span>     <span class="c1"># and detached from the parent process.</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="k">async</span> <span class="k">with</span> <span class="n">rx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">rx</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rx</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">msg</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">childproc</span><span class="p">(</span><span class="n">tx</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">childtask</span><span class="p">(</span><span class="n">tx</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">childtask</span><span class="p">(</span><span class="n">tx</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">async</span> <span class="k">with</span> <span class="n">tx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">tx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;hi from the child process</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
<span class="sa">b</span><span class="s1">&#39;hi from the child process</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div>


<h2 id="duplex-example">Duplex example</h2>
<p>The following example shows a parent and child process sharing a duplex pipe to exchange
messages.</p>
<div class="codehilite"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Process</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">asyncio</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">aiopipe</span> <span class="k">import</span> <span class="n">aioduplex</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">mainpipe</span><span class="p">,</span> <span class="n">chpipe</span> <span class="o">=</span> <span class="n">aioduplex</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="k">with</span> <span class="n">chpipe</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">proc</span> <span class="o">=</span> <span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">childproc</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">chpipe</span><span class="p">,))</span>
<span class="o">...</span>         <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="c1"># The second pipe is now available in the child process</span>
<span class="o">...</span>     <span class="c1"># and detached from the parent process.</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="k">async</span> <span class="k">with</span> <span class="n">mainpipe</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">mainpipe</span><span class="p">:</span>
<span class="o">...</span>         <span class="n">req</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mainpipe</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">...</span>         <span class="k">await</span> <span class="n">mainpipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">req</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot; world</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="o">...</span>         <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mainpipe</span><span class="o">.</span><span class="n">reader</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">msg</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">childproc</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span>
<span class="o">...</span>     <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">childtask</span><span class="p">(</span><span class="n">pipe</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">childtask</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span>
<span class="o">...</span>     <span class="k">async</span> <span class="k">with</span> <span class="n">pipe</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipe</span><span class="p">:</span>
<span class="o">...</span>         <span class="k">await</span> <span class="n">pipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<span class="o">...</span>         <span class="n">rep</span> <span class="o">=</span> <span class="k">await</span> <span class="n">pipe</span><span class="o">.</span><span class="n">reader</span><span class="p">()</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<span class="o">...</span>         <span class="k">await</span> <span class="n">pipe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">rep</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<span class="o">&gt;&gt;&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
<span class="sa">b</span><span class="s1">&#39;HELLO WORLD</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
</pre></div></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This package wraps the [`os.pipe`](https://docs.python.org/3/library/os.html#os.pipe)</span>
<span class="sd">simplex communication pipe so it can be used as part of the non-blocking</span>
<span class="sd">[`asyncio`](https://docs.python.org/3/library/asyncio.html) event loop. A duplex pipe</span>
<span class="sd">is also provided, which allows reading and writing on both ends.</span>

<span class="sd">## Simplex example</span>

<span class="sd">The following example opens a pipe with the write end in the child process and the read</span>
<span class="sd">end in the parent process.</span>

<span class="sd">```python3</span>
<span class="sd">&gt;&gt;&gt; from multiprocessing import Process</span>
<span class="sd">&gt;&gt;&gt; import asyncio</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; from aiopipe import aiopipe</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; async def main():</span>
<span class="sd">...     rx, tx = aiopipe()</span>
<span class="sd">...</span>
<span class="sd">...     with tx.detach() as tx:</span>
<span class="sd">...         proc = Process(target=childproc, args=(tx,))</span>
<span class="sd">...         proc.start()</span>
<span class="sd">...</span>
<span class="sd">...     # The write end is now available in the child process</span>
<span class="sd">...     # and detached from the parent process.</span>
<span class="sd">...</span>
<span class="sd">...     async with rx.open() as rx:</span>
<span class="sd">...         msg = await rx.readline()</span>
<span class="sd">...</span>
<span class="sd">...     proc.join()</span>
<span class="sd">...     return msg</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; def childproc(tx):</span>
<span class="sd">...     asyncio.run(childtask(tx))</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; async def childtask(tx):</span>
<span class="sd">...     async with tx.open() as tx:</span>
<span class="sd">...         tx.write(b&quot;hi from the child process\\n&quot;)</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; asyncio.run(main())</span>
<span class="sd">b&#39;hi from the child process\\n&#39;</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">```</span>

<span class="sd">## Duplex example</span>

<span class="sd">The following example shows a parent and child process sharing a duplex pipe to exchange</span>
<span class="sd">messages.</span>

<span class="sd">```python3</span>
<span class="sd">&gt;&gt;&gt; from multiprocessing import Process</span>
<span class="sd">&gt;&gt;&gt; import asyncio</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; from aiopipe import aioduplex</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; async def main():</span>
<span class="sd">...     mainpipe, chpipe = aioduplex()</span>
<span class="sd">...</span>
<span class="sd">...     with chpipe.detach() as tx:</span>
<span class="sd">...         proc = Process(target=childproc, args=(chpipe,))</span>
<span class="sd">...         proc.start()</span>
<span class="sd">...</span>
<span class="sd">...     # The second pipe is now available in the child process</span>
<span class="sd">...     # and detached from the parent process.</span>
<span class="sd">...</span>
<span class="sd">...     async with mainpipe.open() as mainpipe:</span>
<span class="sd">...         req = await mainpipe.read(5)</span>
<span class="sd">...         await mainpipe.write(req + b&quot; world\\n&quot;)</span>
<span class="sd">...         msg = await mainpipe.reader().readline()</span>
<span class="sd">...</span>
<span class="sd">...     proc.join()</span>
<span class="sd">...     return msg</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; def childproc(pipe):</span>
<span class="sd">...     asyncio.run(childtask(pipe))</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; async def childtask(pipe):</span>
<span class="sd">...     async with pipe.open() as pipe:</span>
<span class="sd">...         await pipe.write(b&quot;hello&quot;)</span>
<span class="sd">...         rep = await pipe.reader().readline()</span>
<span class="sd">...         await pipe.write(rep.upper())</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">&gt;&gt;&gt; asyncio.run(main())</span>
<span class="sd">b&#39;HELLO WORLD\\n&#39;</span>
<span class="sd">&gt;&gt;&gt;</span>
<span class="sd">```</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">asyncio</span> <span class="k">import</span> <span class="n">StreamReader</span><span class="p">,</span> <span class="n">StreamWriter</span><span class="p">,</span> <span class="n">StreamReaderProtocol</span><span class="p">,</span> <span class="n">BaseTransport</span><span class="p">,</span> \
        <span class="n">get_running_loop</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span><span class="p">,</span> <span class="n">asynccontextmanager</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ContextManager</span><span class="p">,</span> <span class="n">AsyncContextManager</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">__pdoc__</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">def</span> <span class="nf">aiopipe</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;AioPipeReader&quot;</span><span class="p">,</span> <span class="s2">&quot;AioPipeWriter&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new simplex multiprocess communication pipe.</span>

<span class="sd">    Return the read end and write end, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rx</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">AioPipeReader</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span> <span class="n">AioPipeWriter</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">aioduplex</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;AioDuplex&quot;</span><span class="p">,</span> <span class="s2">&quot;AioDuplex&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new duplex multiprocess communication pipe.</span>

<span class="sd">    Both returned pipes can write to and read from the other.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rxa</span><span class="p">,</span> <span class="n">txa</span> <span class="o">=</span> <span class="n">aiopipe</span><span class="p">()</span>
    <span class="n">rxb</span><span class="p">,</span> <span class="n">txb</span> <span class="o">=</span> <span class="n">aiopipe</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">AioDuplex</span><span class="p">(</span><span class="n">rxa</span><span class="p">,</span> <span class="n">txb</span><span class="p">),</span> <span class="n">AioDuplex</span><span class="p">(</span><span class="n">rxb</span><span class="p">,</span> <span class="n">txa</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AioPipeStream</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for pipe readers and writers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeStream.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeStream.open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fd</span> <span class="o">=</span> <span class="n">fd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tracks if the fd is controlled by asyncio.</span>

<span class="sd">        This object will only close the fd if it&#39;s not controlled by asyncio. Otherwise,</span>
<span class="sd">        asyncio throws an error when it tries to close the fd itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span><span class="p">,</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">stream</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c1"># The transport/protocol sometimes closes the fd before this is reached.</span>
                <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">BaseTransport</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioPipeStream&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach this end of the pipe from the current process in preparation for use in a</span>
<span class="sd">        child process.</span>

<span class="sd">        This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">        When the context is entered, the stream is prepared for</span>
<span class="sd">        [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">        child process and returned as the context variable. When the context is exited,</span>
<span class="sd">        the stream is closed in the parent process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">set_inheritable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>

<span class="k">class</span> <span class="nc">AioPipeReader</span><span class="p">(</span><span class="n">AioPipeStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The read end of a pipe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeReader.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeReader.open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Open the receive end on the current event loop.</span>

<span class="s2">        This returns an async context manager, which must be used as part of an `async</span>
<span class="s2">        with` context. When the context is entered, the receive end is opened and an</span>
<span class="s2">        instance of [`StreamReader`][stdlib] is returned as the context variable. When the</span>
<span class="s2">        context is exited, the receive end is closed.</span>

<span class="s2">        [stdlib]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">StreamReader</span><span class="p">()</span>
        <span class="n">transport</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_running_loop</span><span class="p">()</span><span class="o">.</span><span class="n">connect_read_pipe</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">StreamReaderProtocol</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">transport</span><span class="p">,</span> <span class="n">rx</span>

<span class="k">class</span> <span class="nc">AioPipeWriter</span><span class="p">(</span><span class="n">AioPipeStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The write end of a pipe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeWriter.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeWriter.open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Open the transmit end on the current event loop.</span>

<span class="s2">        This returns an async context manager, which must be used as part of an `async</span>
<span class="s2">        with` context. When the context is entered, the transmit end is opened and an</span>
<span class="s2">        instance of [`StreamWriter`][stdlib] is returned as the context variable. When the</span>
<span class="s2">        context is exited, the transmit end is closed.</span>

<span class="s2">        [stdlib]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">StreamReader</span><span class="p">()</span>
        <span class="n">transport</span><span class="p">,</span> <span class="n">proto</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_running_loop</span><span class="p">()</span><span class="o">.</span><span class="n">connect_write_pipe</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">StreamReaderProtocol</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">StreamWriter</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transport</span><span class="p">,</span> <span class="n">tx</span>

<span class="k">class</span> <span class="nc">AioDuplexConnection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents one end of an opened duplex pipe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioDuplexConnection.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">:</span> <span class="n">StreamReader</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="n">StreamWriter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span> <span class="o">=</span> <span class="n">rx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span> <span class="o">=</span> <span class="n">tx</span>

    <span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamReader</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the underlying</span>
<span class="sd">        [`StreamReader`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader)</span>
<span class="sd">        instance.</span>

<span class="sd">        This allows access to methods like `readline()`, `readuntil()`, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span>

    <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamWriter</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the underlying</span>
<span class="sd">        [`StreamWriter`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter)</span>
<span class="sd">        instance.</span>

<span class="sd">        This allows access to methods like `writelines()`, `drain()`, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the given bytes and wait for the stream to be drained.</span>

<span class="sd">        This is a convenience method, see [`StreamWriter.write()`][write] for more</span>
<span class="sd">        information.</span>

<span class="sd">        [write]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter.write</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the given number of bytes.</span>

<span class="sd">        This is a convenience method, see [`StreamReader.read()`][read] for more</span>
<span class="sd">        information.</span>

<span class="sd">        [read]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader.read</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AioDuplex</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents one end of a duplex pipe,</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioDuplex.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">:</span> <span class="n">AioPipeReader</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="n">AioPipeWriter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span> <span class="o">=</span> <span class="n">rx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span> <span class="o">=</span> <span class="n">tx</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioDuplex&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach this end of the duplex pipe from the current process in preparation for use</span>
<span class="sd">        in a child process.</span>

<span class="sd">        This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">        When the context is entered, the pipe is prepared for</span>
<span class="sd">        [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">        child process and returned as the context variable. When the context is exited,</span>
<span class="sd">        the stream is closed in the parent process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">detach</span><span class="p">():</span>
            <span class="k">yield</span> <span class="bp">self</span>

    <span class="nd">@asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncContextManager</span><span class="p">[</span><span class="s2">&quot;AioDuplexConnection&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open this end of the duplex pipe on the current event loop.</span>

<span class="sd">        This returns an async context manager, which must be used as part of an `async</span>
<span class="sd">        with` context. When the context is entered, the pipe is opened and an instance of</span>
<span class="sd">        `AioDuplexConnection` is returned as the context variable. When the context is</span>
<span class="sd">        exited, the pipe is closed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">AioDuplexConnection</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    </header>

    <section id="section-items">
        

        
            <h2 class="sectiontitle" id="header-functions">Functions</h2>
            
                
    
    <div class="item">
        <div class="funcdef" id="aiopipe.aioduplex">
            <div class="funcinit">
                <a href="#aiopipe.aioduplex" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">aioduplex</span></div>
                </a>(
                <div class="funcargs">)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>Tuple[<a href="#aiopipe.AioDuplex">AioDuplex</a>, <a href="#aiopipe.AioDuplex">AioDuplex</a>]
            </div>
            
        </div>
        
        
    
        
        <div class="desc"><p>Create a new duplex multiprocess communication pipe.</p>
<p>Both returned pipes can write to and read from the other.</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">aioduplex</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;AioDuplex&quot;</span><span class="p">,</span> <span class="s2">&quot;AioDuplex&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new duplex multiprocess communication pipe.</span>

<span class="sd">    Both returned pipes can write to and read from the other.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rxa</span><span class="p">,</span> <span class="n">txa</span> <span class="o">=</span> <span class="n">aiopipe</span><span class="p">()</span>
    <span class="n">rxb</span><span class="p">,</span> <span class="n">txb</span> <span class="o">=</span> <span class="n">aiopipe</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">AioDuplex</span><span class="p">(</span><span class="n">rxa</span><span class="p">,</span> <span class="n">txb</span><span class="p">),</span> <span class="n">AioDuplex</span><span class="p">(</span><span class="n">rxb</span><span class="p">,</span> <span class="n">txa</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
            
                
    
    <div class="item">
        <div class="funcdef" id="aiopipe.aiopipe">
            <div class="funcinit">
                <a href="#aiopipe.aiopipe" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">aiopipe</span></div>
                </a>(
                <div class="funcargs">)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>Tuple[<a href="#aiopipe.AioPipeReader">AioPipeReader</a>, <a href="#aiopipe.AioPipeWriter">AioPipeWriter</a>]
            </div>
            
        </div>
        
        
    
        
        <div class="desc"><p>Create a new simplex multiprocess communication pipe.</p>
<p>Return the read end and write end, respectively.</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">aiopipe</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;AioPipeReader&quot;</span><span class="p">,</span> <span class="s2">&quot;AioPipeWriter&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new simplex multiprocess communication pipe.</span>

<span class="sd">    Return the read end and write end, respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rx</span><span class="p">,</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">AioPipeReader</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span> <span class="n">AioPipeWriter</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
            
        

        
            <h2 class="sectiontitle" id="header-classes">Classes</h2>
            
                
    
    
    
    
    

    
    
    

    <div class="item">
        <a href="#aiopipe.AioDuplex" id="aiopipe.AioDuplex" class="name">
        <span class="type">class</span> <span class="ident">AioDuplex</span>
    </a>
        
    
        
        <div class="desc"><p>Represents one end of a duplex pipe,</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AioDuplex</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents one end of a duplex pipe,</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioDuplex.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">:</span> <span class="n">AioPipeReader</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="n">AioPipeWriter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span> <span class="o">=</span> <span class="n">rx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span> <span class="o">=</span> <span class="n">tx</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioDuplex&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach this end of the duplex pipe from the current process in preparation for use</span>
<span class="sd">        in a child process.</span>

<span class="sd">        This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">        When the context is entered, the pipe is prepared for</span>
<span class="sd">        [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">        child process and returned as the context variable. When the context is exited,</span>
<span class="sd">        the stream is closed in the parent process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">detach</span><span class="p">():</span>
            <span class="k">yield</span> <span class="bp">self</span>

    <span class="nd">@asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncContextManager</span><span class="p">[</span><span class="s2">&quot;AioDuplexConnection&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open this end of the duplex pipe on the current event loop.</span>

<span class="sd">        This returns an async context manager, which must be used as part of an `async</span>
<span class="sd">        with` context. When the context is entered, the pipe is opened and an instance of</span>
<span class="sd">        `AioDuplexConnection` is returned as the context variable. When the context is</span>
<span class="sd">        exited, the pipe is closed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">AioDuplexConnection</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    

        <div class="class">
            <h3 class="itemtitle" title="Listed in Method Resolution Order">Ancestors</h3>
            <ul class="ancestors">
            
                <li>builtins.object</li>
            
            </ul>
            
            
            
            
            
            
            
                <h3 class="itemtitle">Methods</h3>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioDuplex.detach">
            <div class="funcinit">
                <a href="#aiopipe.AioDuplex.detach" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">detach</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>AbstractContextManager[<a href="#aiopipe.AioDuplex">AioDuplex</a>]
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Detach this end of the duplex pipe from the current process in preparation for use
in a child process.</p>
<p>This returns a context manager, which must be used as part of a <code>with</code> context.
When the context is entered, the pipe is prepared for
<a href="https://docs.python.org/3/library/os.html#fd-inheritance">inheritance</a> by the
child process and returned as the context variable. When the context is exited,
the stream is closed in the parent process.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioDuplex&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detach this end of the duplex pipe from the current process in preparation for use</span>
<span class="sd">    in a child process.</span>

<span class="sd">    This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">    When the context is entered, the pipe is prepared for</span>
<span class="sd">    [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">    child process and returned as the context variable. When the context is exited,</span>
<span class="sd">    the stream is closed in the parent process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">detach</span><span class="p">():</span>
        <span class="k">yield</span> <span class="bp">self</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioDuplex.open">
            <div class="funcinit">
                <a href="#aiopipe.AioDuplex.open" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">open</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>AbstractAsyncContextManager[<a href="#aiopipe.AioDuplexConnection">AioDuplexConnection</a>]
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Open this end of the duplex pipe on the current event loop.</p>
<p>This returns an async context manager, which must be used as part of an <code>async
with</code> context. When the context is entered, the pipe is opened and an instance of
<a href="#aiopipe.AioDuplexConnection"><code>AioDuplexConnection</code></a> is returned as the context variable. When the context is
exited, the pipe is closed.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@asynccontextmanager</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncContextManager</span><span class="p">[</span><span class="s2">&quot;AioDuplexConnection&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open this end of the duplex pipe on the current event loop.</span>

<span class="sd">    This returns an async context manager, which must be used as part of an `async</span>
<span class="sd">    with` context. When the context is entered, the pipe is opened and an instance of</span>
<span class="sd">    `AioDuplexConnection` is returned as the context variable. When the context is</span>
<span class="sd">    exited, the pipe is closed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">rx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">tx</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">AioDuplexConnection</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">tx</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
            
        </div>
    </div>
            
                
    
    
    
    
    

    
    
    

    <div class="item">
        <a href="#aiopipe.AioDuplexConnection" id="aiopipe.AioDuplexConnection" class="name">
        <span class="type">class</span> <span class="ident">AioDuplexConnection</span>
    </a>
        
    
        
        <div class="desc"><p>Represents one end of an opened duplex pipe.</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AioDuplexConnection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents one end of an opened duplex pipe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioDuplexConnection.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rx</span><span class="p">:</span> <span class="n">StreamReader</span><span class="p">,</span> <span class="n">tx</span><span class="p">:</span> <span class="n">StreamWriter</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span> <span class="o">=</span> <span class="n">rx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span> <span class="o">=</span> <span class="n">tx</span>

    <span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamReader</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the underlying</span>
<span class="sd">        [`StreamReader`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader)</span>
<span class="sd">        instance.</span>

<span class="sd">        This allows access to methods like `readline()`, `readuntil()`, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span>

    <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamWriter</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the underlying</span>
<span class="sd">        [`StreamWriter`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter)</span>
<span class="sd">        instance.</span>

<span class="sd">        This allows access to methods like `writelines()`, `drain()`, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the given bytes and wait for the stream to be drained.</span>

<span class="sd">        This is a convenience method, see [`StreamWriter.write()`][write] for more</span>
<span class="sd">        information.</span>

<span class="sd">        [write]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter.write</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the given number of bytes.</span>

<span class="sd">        This is a convenience method, see [`StreamReader.read()`][read] for more</span>
<span class="sd">        information.</span>

<span class="sd">        [read]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader.read</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    

        <div class="class">
            <h3 class="itemtitle" title="Listed in Method Resolution Order">Ancestors</h3>
            <ul class="ancestors">
            
                <li>builtins.object</li>
            
            </ul>
            
            
            
            
            
            
            
                <h3 class="itemtitle">Methods</h3>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioDuplexConnection.read">
            <div class="funcinit">
                <a href="#aiopipe.AioDuplexConnection.read" class="name">
                    <div class="funcname">
                        <span class="type">async def</span>
                        <span class="ident">read</span></div>
                </a>(
                <div class="funcargs">self, n: int = -1)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>bytes
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Read the given number of bytes.</p>
<p>This is a convenience method, see <a href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader.read"><code>StreamReader.read()</code></a> for more
information.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the given number of bytes.</span>

<span class="sd">    This is a convenience method, see [`StreamReader.read()`][read] for more</span>
<span class="sd">    information.</span>

<span class="sd">    [read]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader.read</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioDuplexConnection.reader">
            <div class="funcinit">
                <a href="#aiopipe.AioDuplexConnection.reader" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">reader</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>asyncio.streams.StreamReader
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Retrieve the underlying
<a href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader"><code>StreamReader</code></a>
instance.</p>
<p>This allows access to methods like <code>readline()</code>, <code>readuntil()</code>, etc.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">reader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the underlying</span>
<span class="sd">    [`StreamReader`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader)</span>
<span class="sd">    instance.</span>

<span class="sd">    This allows access to methods like `readline()`, `readuntil()`, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rx</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioDuplexConnection.write">
            <div class="funcinit">
                <a href="#aiopipe.AioDuplexConnection.write" class="name">
                    <div class="funcname">
                        <span class="type">async def</span>
                        <span class="ident">write</span></div>
                </a>(
                <div class="funcargs">self, buf: bytes)</div>
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Write the given bytes and wait for the stream to be drained.</p>
<p>This is a convenience method, see <a href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter.write"><code>StreamWriter.write()</code></a> for more
information.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the given bytes and wait for the stream to be drained.</span>

<span class="sd">    This is a convenience method, see [`StreamWriter.write()`][write] for more</span>
<span class="sd">    information.</span>

<span class="sd">    [write]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter.write</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioDuplexConnection.writer">
            <div class="funcinit">
                <a href="#aiopipe.AioDuplexConnection.writer" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">writer</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>asyncio.streams.StreamWriter
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Retrieve the underlying
<a href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter"><code>StreamWriter</code></a>
instance.</p>
<p>This allows access to methods like <code>writelines()</code>, <code>drain()</code>, etc.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StreamWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve the underlying</span>
<span class="sd">    [`StreamWriter`](https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter)</span>
<span class="sd">    instance.</span>

<span class="sd">    This allows access to methods like `writelines()`, `drain()`, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tx</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
            
        </div>
    </div>
            
                
    
    
    
    
    

    
    
    

    <div class="item">
        <a href="#aiopipe.AioPipeReader" id="aiopipe.AioPipeReader" class="name">
        <span class="type">class</span> <span class="ident">AioPipeReader</span>
    </a>
        
    
        
        <div class="desc"><p>The read end of a pipe.</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AioPipeReader</span><span class="p">(</span><span class="n">AioPipeStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The read end of a pipe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeReader.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeReader.open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Open the receive end on the current event loop.</span>

<span class="s2">        This returns an async context manager, which must be used as part of an `async</span>
<span class="s2">        with` context. When the context is entered, the receive end is opened and an</span>
<span class="s2">        instance of [`StreamReader`][stdlib] is returned as the context variable. When the</span>
<span class="s2">        context is exited, the receive end is closed.</span>

<span class="s2">        [stdlib]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">StreamReader</span><span class="p">()</span>
        <span class="n">transport</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_running_loop</span><span class="p">()</span><span class="o">.</span><span class="n">connect_read_pipe</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">StreamReaderProtocol</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">transport</span><span class="p">,</span> <span class="n">rx</span>
</pre></div>

    
        </div>
    </div>
    
    

        <div class="class">
            <h3 class="itemtitle" title="Listed in Method Resolution Order">Ancestors</h3>
            <ul class="ancestors">
            
                <li><a href="#aiopipe.AioPipeStream" title="aiopipe.AioPipeStream">AioPipeStream</a></li>
            
                <li>builtins.object</li>
            
            </ul>
            
            
            
            
            
            
            
                <h3 class="itemtitle">Methods</h3>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioPipeReader.detach">
            <div class="funcinit">
                <a href="#aiopipe.AioPipeReader.detach" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">detach</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>AbstractContextManager[<a href="#aiopipe.AioPipeStream">AioPipeStream</a>]
            </div>
            
        </div>
        
        
        <p class="inheritance">
         <strong title="Inherited from">⤷</strong>
         <code><a href="#aiopipe.AioPipeStream" title="aiopipe.AioPipeStream">AioPipeStream</a>.<a href="#aiopipe.AioPipeStream.detach" title="aiopipe.AioPipeStream.detach">detach</a></code>
        </p>
    
        
        
    
        
        <div class="desc inherited"><p>Detach this end of the pipe from the current process in preparation for use in a
child process.</p>
<p>This returns a context manager, which must be used as part of a <code>with</code> context.
When the context is entered, the stream is prepared for
<a href="https://docs.python.org/3/library/os.html#fd-inheritance">inheritance</a> by the
child process and returned as the context variable. When the context is exited,
the stream is closed in the parent process.</p></div>
        
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioPipeStream&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detach this end of the pipe from the current process in preparation for use in a</span>
<span class="sd">    child process.</span>

<span class="sd">    This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">    When the context is entered, the stream is prepared for</span>
<span class="sd">    [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">    child process and returned as the context variable. When the context is exited,</span>
<span class="sd">    the stream is closed in the parent process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">set_inheritable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioPipeReader.open">
            <div class="funcinit">
                <a href="#aiopipe.AioPipeReader.open" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">open</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Open the receive end on the current event loop.</p>
<p>This returns an async context manager, which must be used as part of an <code>async
with</code> context. When the context is entered, the receive end is opened and an
instance of <a href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamReader"><code>StreamReader</code></a> is returned as the context variable. When the
context is exited, the receive end is closed.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@asynccontextmanager</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">transport</span><span class="p">,</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">stream</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c1"># The transport/protocol sometimes closes the fd before this is reached.</span>
            <span class="k">pass</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
            
        </div>
    </div>
            
                
    
    
    
    
    

    
    
    

    <div class="item">
        <a href="#aiopipe.AioPipeStream" id="aiopipe.AioPipeStream" class="name">
        <span class="type">class</span> <span class="ident">AioPipeStream</span>
    </a>
        
    
        
        <div class="desc"><p>Abstract class for pipe readers and writers.</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AioPipeStream</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class for pipe readers and writers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeStream.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeStream.open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fd</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fd</span> <span class="o">=</span> <span class="n">fd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tracks if the fd is controlled by asyncio.</span>

<span class="sd">        This object will only close the fd if it&#39;s not controlled by asyncio. Otherwise,</span>
<span class="sd">        asyncio throws an error when it tries to close the fd itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">transport</span><span class="p">,</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">stream</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                <span class="c1"># The transport/protocol sometimes closes the fd before this is reached.</span>
                <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">BaseTransport</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioPipeStream&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detach this end of the pipe from the current process in preparation for use in a</span>
<span class="sd">        child process.</span>

<span class="sd">        This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">        When the context is entered, the stream is prepared for</span>
<span class="sd">        [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">        child process and returned as the context variable. When the context is exited,</span>
<span class="sd">        the stream is closed in the parent process.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">set_inheritable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>

    
        </div>
    </div>
    
    

        <div class="class">
            <h3 class="itemtitle" title="Listed in Method Resolution Order">Ancestors</h3>
            <ul class="ancestors">
            
                <li>builtins.object</li>
            
            </ul>
            
            
            
            
            
            
            
                <h3 class="itemtitle">Methods</h3>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioPipeStream.detach">
            <div class="funcinit">
                <a href="#aiopipe.AioPipeStream.detach" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">detach</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>AbstractContextManager[<a href="#aiopipe.AioPipeStream">AioPipeStream</a>]
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Detach this end of the pipe from the current process in preparation for use in a
child process.</p>
<p>This returns a context manager, which must be used as part of a <code>with</code> context.
When the context is entered, the stream is prepared for
<a href="https://docs.python.org/3/library/os.html#fd-inheritance">inheritance</a> by the
child process and returned as the context variable. When the context is exited,
the stream is closed in the parent process.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioPipeStream&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detach this end of the pipe from the current process in preparation for use in a</span>
<span class="sd">    child process.</span>

<span class="sd">    This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">    When the context is entered, the stream is prepared for</span>
<span class="sd">    [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">    child process and returned as the context variable. When the context is exited,</span>
<span class="sd">    the stream is closed in the parent process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">set_inheritable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
            
        </div>
    </div>
            
                
    
    
    
    
    

    
    
    

    <div class="item">
        <a href="#aiopipe.AioPipeWriter" id="aiopipe.AioPipeWriter" class="name">
        <span class="type">class</span> <span class="ident">AioPipeWriter</span>
    </a>
        
    
        
        <div class="desc"><p>The write end of a pipe.</p></div>
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">AioPipeWriter</span><span class="p">(</span><span class="n">AioPipeStream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The write end of a pipe.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeWriter.__init__&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__pdoc__</span><span class="p">[</span><span class="s2">&quot;AioPipeWriter.open&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Open the transmit end on the current event loop.</span>

<span class="s2">        This returns an async context manager, which must be used as part of an `async</span>
<span class="s2">        with` context. When the context is entered, the transmit end is opened and an</span>
<span class="s2">        instance of [`StreamWriter`][stdlib] is returned as the context variable. When the</span>
<span class="s2">        context is exited, the transmit end is closed.</span>

<span class="s2">        [stdlib]: https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">StreamReader</span><span class="p">()</span>
        <span class="n">transport</span><span class="p">,</span> <span class="n">proto</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_running_loop</span><span class="p">()</span><span class="o">.</span><span class="n">connect_write_pipe</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">StreamReaderProtocol</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">StreamWriter</span><span class="p">(</span><span class="n">transport</span><span class="p">,</span> <span class="n">proto</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transport</span><span class="p">,</span> <span class="n">tx</span>
</pre></div>

    
        </div>
    </div>
    
    

        <div class="class">
            <h3 class="itemtitle" title="Listed in Method Resolution Order">Ancestors</h3>
            <ul class="ancestors">
            
                <li><a href="#aiopipe.AioPipeStream" title="aiopipe.AioPipeStream">AioPipeStream</a></li>
            
                <li>builtins.object</li>
            
            </ul>
            
            
            
            
            
            
            
                <h3 class="itemtitle">Methods</h3>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioPipeWriter.detach">
            <div class="funcinit">
                <a href="#aiopipe.AioPipeWriter.detach" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">detach</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
            <div class="funcret name">
                <span class="funcarrow">→</span>AbstractContextManager[<a href="#aiopipe.AioPipeStream">AioPipeStream</a>]
            </div>
            
        </div>
        
        
        <p class="inheritance">
         <strong title="Inherited from">⤷</strong>
         <code><a href="#aiopipe.AioPipeStream" title="aiopipe.AioPipeStream">AioPipeStream</a>.<a href="#aiopipe.AioPipeStream.detach" title="aiopipe.AioPipeStream.detach">detach</a></code>
        </p>
    
        
        
    
        
        <div class="desc inherited"><p>Detach this end of the pipe from the current process in preparation for use in a
child process.</p>
<p>This returns a context manager, which must be used as part of a <code>with</code> context.
When the context is entered, the stream is prepared for
<a href="https://docs.python.org/3/library/os.html#fd-inheritance">inheritance</a> by the
child process and returned as the context variable. When the context is exited,
the stream is closed in the parent process.</p></div>
        
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContextManager</span><span class="p">[</span><span class="s2">&quot;AioPipeStream&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detach this end of the pipe from the current process in preparation for use in a</span>
<span class="sd">    child process.</span>

<span class="sd">    This returns a context manager, which must be used as part of a `with` context.</span>
<span class="sd">    When the context is entered, the stream is prepared for</span>
<span class="sd">    [inheritance](https://docs.python.org/3/library/os.html#fd-inheritance) by the</span>
<span class="sd">    child process and returned as the context variable. When the context is exited,</span>
<span class="sd">    the stream is closed in the parent process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">set_inheritable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">yield</span> <span class="bp">self</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fd</span><span class="p">)</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
                    
    
    <div class="item">
        <div class="funcdef" id="aiopipe.AioPipeWriter.open">
            <div class="funcinit">
                <a href="#aiopipe.AioPipeWriter.open" class="name">
                    <div class="funcname">
                        <span class="type">def</span>
                        <span class="ident">open</span></div>
                </a>(
                <div class="funcargs">self)</div>
            </div>
            
        </div>
        
        
        
        
    
        
        <div class="desc"><p>Open the transmit end on the current event loop.</p>
<p>This returns an async context manager, which must be used as part of an <code>async
with</code> context. When the context is entered, the transmit end is opened and an
instance of <a href="https://docs.python.org/3/library/asyncio-stream.html#asyncio.StreamWriter"><code>StreamWriter</code></a> is returned as the context variable. When the
context is exited, the transmit end is closed.</p></div>
    
    
    
    
    
    <div class="sourcecontainer">
        <a href="#" class="sourcebutton">
            Source <span class="expandicon"></span>
        </a>
        <div class="source hidden">
            
    <div class="codehilite"><pre><span></span><span class="nd">@asynccontextmanager</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">transport</span><span class="p">,</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_moved</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">stream</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">transport</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="c1"># The transport/protocol sometimes closes the fd before this is reached.</span>
            <span class="k">pass</span>
</pre></div>

    
        </div>
    </div>
    
    
    
    </div>
                
            
        </div>
    </div>
            
        

        

        

        
    </section>
        </div>
    </div>

    </main>

    <script>
    Array.from(document.getElementsByClassName("sourcecontainer")).forEach(function(el) {
    var button = el.getElementsByClassName("sourcebutton")[0];
    var icon = el.getElementsByClassName("expandicon")[0];
    var source = el.getElementsByClassName("source")[0];

    button.addEventListener("click", function(e) {
        e.preventDefault();
        source.classList.toggle("hidden");
        icon.classList.toggle("active");
    });
});
    </script>

    
</body>
</html>
